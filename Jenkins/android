pipeline {
    agent any

    environment {
        TEMPL_DIR = 'temp_apks'
        TGZ_FILE = 'apks.tgz'
        DEST_DIR = 'caminho/para/novo/local/'
    }

    stages {
        stage('Buscar e Copiar APKs') {
            steps {
                script {
                    // Cria um diretório temporário para armazenar os APKs
                    dir(TEMPL_DIR) {
                        // Busca todos os arquivos .apk no workspace
                        def apks = findFiles(glob: '**/*.apk')

                        // Copia os APKs para o diretório temporário
                        apks.each { apk ->
                            sh "cp ${apk} ."
                        }
                    }
                }
            }
        }

        stage('Comprimir APKs em TGZ') {
            steps {
                script {
                    // Cria um arquivo TGZ com os APKs
                    sh "tar -czf ${TGZ_FILE} ${TEMPL_DIR}/*"
                }
            }
        }
    }

    post {
        success {
            // Move o arquivo TGZ para o diretório desejado
            sh "mv ${TGZ_FILE} ${DEST_DIR}"
        }
    }
}